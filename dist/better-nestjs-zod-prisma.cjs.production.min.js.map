{"version":3,"file":"better-nestjs-zod-prisma.cjs.production.min.js","sources":["../src/config.ts","../src/docs.ts","../src/types.ts","../src/util.ts","../src/index.ts","../src/generator.ts"],"sourcesContent":["import { z } from 'zod'\n\nconst configBoolean = z\n  .enum(['true', 'false'])\n  .transform((arg) => arg === 'true')\n\nexport const configSchema = z.object({\n  relationModel: configBoolean.default('true').or(z.literal('default')),\n  generateDto: configBoolean.default('true'),\n  modelSuffix: z.string().default('Model'),\n  dtoSuffix: z.string().default('Dto'),\n  modelCase: z.enum(['PascalCase', 'camelCase']).default('PascalCase'),\n  dtoCase: z.enum(['PascalCase', 'camelCase']).default('PascalCase'),\n  useDecimalJs: configBoolean.default('false'),\n  imports: z.string().optional(),\n  prismaJsonNullability: configBoolean.default('true'),\n  enableOpenAPI: configBoolean.default('false')\n})\n\nexport type Config = z.infer<typeof configSchema>\n\nexport interface PrismaOptions {\n  schemaPath: string\n  outputPath: string\n  clientPath: string\n}\n\nexport interface Names {\n  model: string\n  related: string\n}\n","enum Directive {\n  Start = '@z.',\n  Append = '@z&.',\n}\n\nconst SLICE_OFFSETS: Record<Directive, number> = {\n  [Directive.Start]: 1,\n  [Directive.Append]: 3,\n}\n\nfunction hasDirectives(line: string, directives = Object.values(Directive)) {\n  return directives.some((directive) => {\n    return line.trim().startsWith(directive)\n  })\n}\n\nfunction hasNoDirectives(line: string, directives?: Directive[]) {\n  return !hasDirectives(line, directives)\n}\n\nfunction extractDirectiveValue(lines: string[], directive: Directive) {\n  for (const line of lines) {\n    if (hasNoDirectives(line, [directive])) continue\n    return line.trim().slice(SLICE_OFFSETS[directive])\n  }\n\n  return null\n}\n\nexport const getJSDocs = (docString?: string) => {\n  const lines: string[] = []\n\n  if (docString) {\n    const docLines = docString\n      .split('\\n')\n      .filter((line) => hasNoDirectives(line))\n\n    if (docLines.length > 0) {\n      lines.push('/**')\n      docLines.forEach((line) => lines.push(` * ${line}`))\n      lines.push(' */')\n    }\n  }\n\n  return lines\n}\n\nexport function findCustomSchema(documentation: string): string | null {\n  const lines = documentation.split('\\n')\n  return extractDirectiveValue(lines, Directive.Start)\n}\n\nexport function findSchemaAppends(documentation: string): string[] {\n  const appends: string[] = []\n\n  for (const line of documentation.split('\\n')) {\n    const append = extractDirectiveValue([line], Directive.Append)\n    if (append) appends.push(append)\n  }\n\n  return appends\n}\n","import type { DMMF } from '@prisma/generator-helper'\nimport { findCustomSchema, findSchemaAppends } from './docs'\n\nconst mapScalarType: Record<string, string> = {\n  String: 'z.string()',\n  Int: 'z.number().int()',\n  BigInt: 'z.bigint()',\n  DateTime: 'z.date()',\n  Float: 'z.number()',\n  Decimal: 'z.number()',\n  Json: 'z.string()',\n  Boolean: 'z.boolean()',\n  Bytes: 'z.instanceOf(Buffer)',\n}\n\nexport const getZodConstructor = (\n  field: DMMF.Field,\n  getRelatedModelName = (\n    name: string | DMMF.SchemaEnum | DMMF.OutputType | DMMF.SchemaArg\n  ) => name.toString()\n) => {\n  let schema: string\n\n  if (\n    field.kind === 'scalar' &&\n    typeof field.type === 'string' &&\n    Object.prototype.hasOwnProperty.call(mapScalarType, field.type)\n  ) {\n    schema = mapScalarType[field.type]\n  } else if (field.kind === 'enum') {\n    schema = `z.nativeEnum($Enums.${field.type})`\n  } else if (field.kind === 'object') {\n    schema = getRelatedModelName(field.type)\n  } else {\n    schema = 'z.unknown()'\n  }\n\n  let isCustom = false\n\n  if (field.documentation) {\n    const custom = findCustomSchema(field.documentation)\n    const appends = findSchemaAppends(field.documentation)\n\n    if (custom) {\n      isCustom = true\n      schema = custom\n    }\n\n    for (const append of appends) {\n      schema += append\n    }\n  }\n\n  if (field.isList && !isCustom) {\n    schema += '.array()'\n  }\n\n  if (!field.isRequired && field.type !== 'Json') {\n    schema += '.nullable()'\n  }\n\n  return schema\n}\n","import { DMMF } from '@prisma/generator-helper'\nimport type { CodeBlockWriter } from 'ts-morph'\nimport { Config } from './config'\n\nexport const writeArray = (\n  writer: CodeBlockWriter,\n  array: string[],\n  newLine = true\n) => array.forEach((line) => writer.write(line).conditionalNewLine(newLine))\n\nexport const useModelNames = ({\n  modelCase,\n  modelSuffix,\n  dtoSuffix,\n  dtoCase,\n  relationModel,\n}: Config) => {\n  const formatModelName = (name: string, prefix = '') => {\n    let result = name\n    if (modelCase === 'camelCase') {\n      result = result.slice(0, 1).toLowerCase() + result.slice(1)\n    }\n    return `${prefix}${result}${modelSuffix}`\n  }\n\n  const formatDtoName = (name: string) => {\n    let result = name\n    if (dtoCase === 'camelCase') {\n      result = result.slice(0, 1).toLowerCase() + result.slice(1)\n    }\n    return `${result}${dtoSuffix}`\n  }\n\n  return {\n    modelName: (name: string) =>\n      formatModelName(name, relationModel === 'default' ? '_' : ''),\n    dtoName: (name: string) => formatDtoName(name),\n    relatedModelName: (\n      name: string | DMMF.SchemaEnum | DMMF.OutputType | DMMF.SchemaArg\n    ) =>\n      formatModelName(\n        relationModel === 'default'\n          ? name.toString()\n          : `Related${name.toString()}`\n      ),\n  }\n}\n\nexport const needsRelatedModel = (model: DMMF.Model, config: Config) =>\n  model.fields.some((field) => field.kind === 'object') &&\n  config.relationModel !== false\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const chunk = <T extends any[]>(input: T, size: number): T[] => {\n  return input.reduce((array, item, idx) => {\n    return idx % size === 0\n      ? [...array, [item]]\n      : [...array.slice(0, -1), [...array.slice(-1)[0], item]]\n  }, [])\n}\n\nexport const dotSlash = (input: string) => {\n  const converted = input\n    .replace(/^\\\\\\\\\\?\\\\/, '')\n    .replace(/\\\\/g, '/')\n    .replace(/\\/\\/+/g, '/')\n\n  if (converted.includes(`/node_modules/`))\n    return converted.split(`/node_modules/`).slice(-1)[0]\n\n  if (converted.startsWith(`../`)) return converted\n\n  return './' + converted\n}\n","import { generatorHandler } from '@prisma/generator-helper'\nimport { Project } from 'ts-morph'\nimport { SemicolonPreference } from 'typescript'\nimport { configSchema, PrismaOptions } from './config'\nimport {\n  populateModelFile,\n  generateBarrelFile,\n  generateEnumsFile,\n} from './generator'\n\nconst { version } = require('../package.json')\n\ngeneratorHandler({\n  onManifest() {\n    return {\n      version,\n      prettyName: 'NestJS Zod Schemas',\n      defaultOutput: './src/zod',\n    }\n  },\n  onGenerate(options) {\n    const project = new Project()\n\n    const models = options.dmmf.datamodel.models\n    const enums = options.dmmf.datamodel.enums\n\n    const { schemaPath } = options\n    const outputPath = options.generator.output!.value\n    const clientPath = options.otherGenerators.find(\n      (each) => each.provider.value === 'prisma-client-js'\n    )!.output!.value!\n\n    const results = configSchema.safeParse(options.generator.config)\n    if (!results.success)\n      throw new Error(\n        'Incorrect config provided. Please check the values you provided and try again.'\n      )\n\n    const config = results.data\n    const prismaOptions: PrismaOptions = {\n      clientPath,\n      outputPath,\n      schemaPath,\n    }\n\n    const indexFile = project.createSourceFile(\n      `${outputPath}/index.ts`,\n      {},\n      { overwrite: true }\n    )\n\n    generateBarrelFile(models, indexFile)\n\n    indexFile.formatText({\n      indentSize: 2,\n      convertTabsToSpaces: true,\n      semicolons: SemicolonPreference.Remove,\n    })\n\n    models.forEach((model) => {\n      const sourceFile = project.createSourceFile(\n        `${outputPath}/${model.name.toLowerCase()}.ts`,\n        {},\n        { overwrite: true }\n      )\n\n      populateModelFile(model, sourceFile, config, prismaOptions)\n\n      sourceFile.formatText({\n        indentSize: 2,\n        convertTabsToSpaces: true,\n        semicolons: SemicolonPreference.Remove,\n      })\n    })\n\n    if (enums.length > 0) {\n      const enumsFile = project.createSourceFile(\n        `${outputPath}/enums.ts`,\n        {},\n        { overwrite: true }\n      )\n\n      generateEnumsFile(enums, enumsFile)\n\n      enumsFile.formatText({\n        indentSize: 2,\n        convertTabsToSpaces: true,\n        semicolons: SemicolonPreference.Remove,\n      })\n    }\n\n    return project.save()\n  },\n})\n","import path from 'path'\nimport {\n  ImportDeclarationStructure,\n  SourceFile,\n  StructureKind,\n  VariableDeclarationKind,\n} from 'ts-morph'\nimport { DMMF } from '@prisma/generator-helper'\nimport { Config, PrismaOptions } from './config'\nimport { getJSDocs } from './docs'\nimport { getZodConstructor } from './types'\nimport { dotSlash, needsRelatedModel, useModelNames, writeArray } from './util'\n\nexport const writeImportsForModel = (\n  model: DMMF.Model,\n  sourceFile: SourceFile,\n  config: Config,\n  { schemaPath, outputPath }: PrismaOptions\n) => {\n  const { relatedModelName } = useModelNames(config)\n\n  const importList: ImportDeclarationStructure[] = [\n    {\n      kind: StructureKind.ImportDeclaration,\n      namespaceImport: 'z',\n      moduleSpecifier: 'zod',\n    },\n  ]\n\n  if(config.enableOpenAPI)\n    {\n      // ability to use openapi in nestjs-zod\n      importList.push({\n        kind: StructureKind.ImportDeclaration,\n        namedImports: ['$Enums'],\n        moduleSpecifier: '@prisma/client',\n      })\n\n        // ability to use openapi in nestjs-zod\n      importList.push({\n        kind: StructureKind.ImportDeclaration,\n        namedImports: ['extendZodWithOpenApi'],\n        moduleSpecifier: '@anatine/zod-openapi',\n      })\n\n    }\n\n  if (config.generateDto) {\n    importList.push({\n      kind: StructureKind.ImportDeclaration,\n      namedImports: ['createZodDto'],\n      moduleSpecifier: '@anatine/zod-nestjs',\n    })\n  }\n\n  if (config.imports) {\n    importList.push({\n      kind: StructureKind.ImportDeclaration,\n      namespaceImport: 'imports',\n      moduleSpecifier: dotSlash(\n        path.relative(\n          outputPath,\n          path.resolve(path.dirname(schemaPath), config.imports)\n        )\n      ),\n    })\n  }\n\n  if (config.useDecimalJs && model.fields.some((f) => f.type === 'Decimal')) {\n    importList.push({\n      kind: StructureKind.ImportDeclaration,\n      namedImports: ['Decimal'],\n      moduleSpecifier: 'decimal.js',\n    })\n  }\n\n  const enumFields = model.fields.filter((f) => f.kind === 'enum')\n\n  // Keep track of imported enum types\n  const importedEnums = new Set<string>()\n\n  // Filter out duplicate enum types\n  const uniqueEnumFields = enumFields.filter((f) => {\n    const typeName = f.type\n    if (!importedEnums.has(typeName)) {\n      importedEnums.add(typeName)\n      return true\n    }\n    return false\n  })\n\n  if (uniqueEnumFields.length > 0) {\n    importList.push({\n      kind: StructureKind.ImportDeclaration,\n      isTypeOnly: uniqueEnumFields.length === 0,\n      moduleSpecifier: dotSlash('enums'),\n      namedImports: uniqueEnumFields.map((f) => f.type),\n    })\n  }\n\n  const relationFields = model.fields.filter((f) => f.kind === 'object')\n\n  if (config.relationModel !== false && relationFields.length > 0) {\n    const filteredFields = relationFields.filter((f) => f.type !== model.name)\n\n    if (filteredFields.length > 0) {\n      importList.push({\n        kind: StructureKind.ImportDeclaration,\n        moduleSpecifier: './index',\n        namedImports: Array.from(\n          new Set(\n            filteredFields.flatMap((f) => [\n              `Complete${f.type}`,\n              relatedModelName(f.type),\n            ])\n          )\n        ),\n      })\n    }\n  }\n\n  sourceFile.addImportDeclarations(importList)\n\n  sourceFile.addVariableStatement({\n    declarationKind: VariableDeclarationKind.Const,\n    declarations: [\n      {\n        initializer: (writer) => writer.write('extendZodWithOpenApi(z)'),\n        name: 'zodOpenApi',\n      },\n    ],\n  })\n}\n\nexport const writeTypeSpecificSchemas = (\n  model: DMMF.Model,\n  sourceFile: SourceFile,\n  config: Config,\n  _prismaOptions: PrismaOptions\n) => {\n  if (config.useDecimalJs && model.fields.some((f) => f.type === 'Decimal')) {\n    sourceFile.addStatements((writer) => {\n      writer.newLine()\n      writeArray(writer, [\n        '// Helper schema for Decimal fields',\n        'z',\n        '.instanceof(Decimal)',\n        '.or(z.string())',\n        '.or(z.number())',\n        '.refine((value) => {',\n        '  try {',\n        '    return new Decimal(value);',\n        '  } catch (error) {',\n        '    return false;',\n        '  }',\n        '})',\n        '.transform((value) => new Decimal(value));',\n      ])\n    })\n  }\n}\n\nexport const generateSchemaForModel = (\n  model: DMMF.Model,\n  sourceFile: SourceFile,\n  config: Config,\n  _prismaOptions: PrismaOptions\n) => {\n  const { modelName } = useModelNames(config)\n\n  sourceFile.addVariableStatement({\n    declarationKind: VariableDeclarationKind.Const,\n    isExported: true,\n    leadingTrivia: (writer) => writer.blankLineIfLastNot(),\n    declarations: [\n      {\n        name: modelName(model.name),\n        initializer(writer) {\n          writer\n            .write('z.object(')\n            .inlineBlock(() => {\n              model.fields\n                .filter((f) => f.kind !== 'object')\n                .forEach((field) => {\n                  writeArray(writer, getJSDocs(field.documentation))\n                  writer\n                    .write(`${field.name}: ${getZodConstructor(field)}`)\n                    .write(',')\n                    .newLine()\n                })\n            })\n            .write(')')\n        },\n      },\n    ],\n  })\n}\n\nexport const generateDto = (\n  model: DMMF.Model,\n  sourceFile: SourceFile,\n  config: Config\n) => {\n  const { modelName, dtoName } = useModelNames(config)\n\n  sourceFile.addClass({\n    name: dtoName(model.name),\n    isExported: true,\n    leadingTrivia: (writer) => writer.blankLineIfLastNot(),\n    extends: `createZodDto(${modelName(model.name)})`,\n  })\n}\n\nexport const generateRelatedSchemaForModel = (\n  model: DMMF.Model,\n  sourceFile: SourceFile,\n  config: Config,\n  _prismaOptions: PrismaOptions\n) => {\n  const { modelName, relatedModelName } = useModelNames(config)\n\n  const relationFields = model.fields.filter((f) => f.kind === 'object')\n\n  sourceFile.addInterface({\n    name: `Complete${model.name}`,\n    isExported: true,\n    extends: [`z.infer<typeof ${modelName(model.name)}>`],\n    properties: relationFields.map((f) => ({\n      hasQuestionToken: !f.isRequired,\n      name: f.name,\n      type: `Complete${f.type}${f.isList ? '[]' : ''}${\n        !f.isRequired ? ' | null' : ''\n      }`,\n    })),\n  })\n\n  sourceFile.addStatements((writer) =>\n    writeArray(writer, [\n      '',\n      '/**',\n      ` * ${relatedModelName(\n        `${model.name}?`\n      )} contains all relations on your model in addition to the scalars`,\n      ' *',\n      ' * NOTE: Lazy required in case of potential circular dependencies within schema',\n      ' */',\n    ])\n  )\n\n  sourceFile.addVariableStatement({\n    declarationKind: VariableDeclarationKind.Const,\n    isExported: true,\n    declarations: [\n      {\n        name: relatedModelName(model.name),\n        type: `z.ZodSchema<Complete${model.name}>`,\n        initializer(writer) {\n          writer\n            .write(`z.lazy(() => ${modelName(model.name)}.extend(`)\n            .inlineBlock(() => {\n              relationFields.forEach((field) => {\n                writeArray(writer, getJSDocs(field.documentation))\n\n                writer\n                  .write(\n                    `${field.name}: ${getZodConstructor(\n                      field,\n                      relatedModelName\n                    )}`\n                  )\n                  .write(',')\n                  .newLine()\n              })\n            })\n            .write('))')\n        },\n      },\n    ],\n  })\n}\n\nexport const populateModelFile = (\n  model: DMMF.Model,\n  sourceFile: SourceFile,\n  config: Config,\n  prismaOptions: PrismaOptions\n) => {\n  writeImportsForModel(model, sourceFile, config, prismaOptions)\n  writeTypeSpecificSchemas(model, sourceFile, config, prismaOptions)\n  generateSchemaForModel(model, sourceFile, config, prismaOptions)\n  if (config.generateDto) generateDto(model, sourceFile, config)\n  if (needsRelatedModel(model, config))\n    generateRelatedSchemaForModel(model, sourceFile, config, prismaOptions)\n}\n\nexport const generateBarrelFile = (\n  models: DMMF.Model[],\n  indexFile: SourceFile\n) => {\n  models.forEach((model) =>\n    indexFile.addExportDeclaration({\n      moduleSpecifier: `./${model.name.toLowerCase()}`,\n    })\n  )\n}\n\nexport const generateEnumsFile = (\n  enums: DMMF.DatamodelEnum[],\n  enumsFile: SourceFile\n) => {\n  for (const { name, values } of enums) {\n    const members = values.map(({ name: memberName }) => {\n      return { name: memberName, value: memberName }\n    })\n\n    enumsFile\n      .addEnum({\n        name,\n        members,\n      })\n      .setIsExported(true)\n  }\n}\n"],"names":["configBoolean","z","enum","transform","arg","configSchema","object","relationModel","default","or","literal","generateDto","modelSuffix","string","dtoSuffix","modelCase","dtoCase","useDecimalJs","imports","optional","prismaJsonNullability","enableOpenAPI","Directive","SLICE_OFFSETS","Start","Append","hasNoDirectives","line","directives","Object","values","some","directive","trim","startsWith","hasDirectives","extractDirectiveValue","lines","slice","getJSDocs","docString","docLines","split","filter","length","push","forEach","mapScalarType","String","Int","BigInt","DateTime","Float","Decimal","Json","Boolean","Bytes","getZodConstructor","field","getRelatedModelName","name","toString","schema","kind","type","prototype","hasOwnProperty","call","isCustom","documentation","custom","appends","append","findSchemaAppends","isList","isRequired","writeArray","writer","array","newLine","write","conditionalNewLine","useModelNames","formatModelName","prefix","result","toLowerCase","modelName","dtoName","formatDtoName","relatedModelName","dotSlash","input","converted","replace","includes","version","require","generatorHandler","onManifest","prettyName","defaultOutput","onGenerate","options","project","Project","models","dmmf","datamodel","enums","schemaPath","outputPath","generator","output","value","clientPath","otherGenerators","find","each","provider","results","safeParse","config","success","Error","data","prismaOptions","indexFile","createSourceFile","overwrite","generateBarrelFile","model","addExportDeclaration","moduleSpecifier","formatText","indentSize","convertTabsToSpaces","semicolons","SemicolonPreference","Remove","sourceFile","populateModelFile","writeImportsForModel","importList","StructureKind","ImportDeclaration","namespaceImport","namedImports","path","relative","resolve","dirname","fields","f","enumFields","importedEnums","Set","uniqueEnumFields","typeName","has","add","isTypeOnly","map","relationFields","filteredFields","Array","from","flatMap","addImportDeclarations","addVariableStatement","declarationKind","VariableDeclarationKind","Const","declarations","initializer","writeTypeSpecificSchemas","_prismaOptions","addStatements","generateSchemaForModel","isExported","leadingTrivia","blankLineIfLastNot","inlineBlock","addClass","extends","needsRelatedModel","generateRelatedSchemaForModel","addInterface","properties","hasQuestionToken","enumsFile","generateEnumsFile","members","memberName","addEnum","setIsExported","save"],"mappings":"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"}